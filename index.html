<html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster: Your Life Gamified</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    
    <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  const firebaseConfig = {
  apiKey: "AIzaSyAlKv02m17vC7joa_zmBMIfX1b6MlJFXzU",
  authDomain: "taskmaster-4b92f.firebaseapp.com",
  projectId: "taskmaster-4b92f",
  storageBucket: "taskmaster-4b92f.firebasestorage.app",
  messagingSenderId: "861696268961",
  appId: "1:861696268961:web:b34e6c50208ef03711aee0"
};
  

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, getDocs, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        window.firebase = {
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged,
            getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, getDocs,
            serverTimestamp, increment
        };
    </script>

    <script>
        dayjs.extend(dayjs_plugin_relativeTime);
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], },
                    colors: {
                        'brand-primary': '#1a1a1a', 'brand-secondary': '#2c2c2c',
                        'brand-accent': '#4f46e5', 'brand-accent-hover': '#4338ca',
                        'brand-text': '#f5f5f5', 'brand-subtle': '#a3a3a3',
                        'brand-success': '#22c55e', 'brand-warning': '#facc15',
                        'brand-danger': '#ef4444', 'brand-gold': '#ffd700',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #1a1a1a; color: #f5f5f5; }
        .modal-backdrop { background-color: rgba(0,0,0,0.7); }
        .task-card { background: linear-gradient(145deg, #2e2e2e, #262626); box-shadow: 8px 8px 16px #1e1e1e, -8px -8px 16px #343434; }
        .btn { transition: all 0.2s ease-in-out; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .tab-active { border-bottom-color: #4f46e5; color: #f5f5f5; }
        .tab { border-bottom-color: transparent; color: #a3a3a3; }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-4xl font-sans">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-brand-text">TaskMaster</h1>
            <div class="flex items-center space-x-2 sm:space-x-4">
                <button id="leaderboard-btn" class="btn bg-brand-secondary p-3 rounded-full hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-brand-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                </button>
                <div class="text-right">
                    <p class="text-brand-subtle text-sm">Points</p>
                    <p id="points-display" class="text-2xl font-bold text-brand-accent">0</p>
                </div>
                <button id="shop-btn" class="btn bg-brand-secondary p-3 rounded-full hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-brand-text" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-content" class="text-center p-8 rounded-2xl task-card min-h-[300px] flex flex-col justify-center items-center">
            <!-- Populated by JS -->
        </main>

        <!-- Footer Controls -->
        <footer class="mt-8 flex justify-center">
            <button id="manage-btn" class="btn bg-brand-secondary hover:bg-gray-700 text-brand-text font-bold py-3 px-6 rounded-lg shadow-lg">Manage Tasks & Forfeits</button>
        </footer>

    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex justify-center items-center p-4">
        <div class="bg-brand-secondary rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-gray-700 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-brand-gold">30-Day Leaderboard</h2>
                <button class="close-modal-btn text-gray-400 hover:text-white" data-modal="leaderboard-modal">&times;</button>
            </div>
            <div id="leaderboard-content" class="p-6 overflow-y-auto">
                <!-- Leaderboard entries will be rendered here -->
            </div>
        </div>
    </div>
    
    <!-- Other Modals (Shop, Manage, Result, etc.) -->
    <div id="shop-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex justify-center items-center p-4">
        <div class="bg-brand-secondary rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-gray-700 flex justify-between items-center"><h2 class="text-2xl font-bold">Reward Shop</h2><button class="close-modal-btn text-gray-400 hover:text-white" data-modal="shop-modal">&times;</button></div>
            <div id="shop-content" class="p-6 overflow-y-auto"></div>
            <div class="p-4 border-t border-gray-700"><button id="log-toggle-btn" class="w-full btn bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">View Purchase History</button></div>
        </div>
    </div>
    <div id="manage-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex justify-center items-center p-4">
        <div class="bg-brand-secondary rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-gray-700 flex justify-between items-center"><h2 class="text-2xl font-bold">Manage Your Setup</h2><button class="close-modal-btn text-gray-400 hover:text-white" data-modal="manage-modal">&times;</button></div>
            <div class="flex border-b border-gray-700 px-6"><button data-tab="tasks" class="tab tab-active text-lg font-semibold py-4 mr-6">Tasks</button><button data-tab="forfeits" class="tab text-lg font-semibold py-4 mr-6">Forfeits</button><button data-tab="settings" class="tab text-lg font-semibold py-4">Settings</button></div>
            <div class="p-6 overflow-y-auto"><div id="tasks-tab" class="tab-content"></div><div id="forfeits-tab" class="tab-content hidden"></div><div id="settings-tab" class="tab-content hidden"></div></div>
        </div>
    </div>
    <div id="result-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex justify-center items-center p-4"><div class="bg-brand-secondary rounded-2xl shadow-2xl w-full max-w-md text-center p-8"><h2 id="result-title" class="text-2xl font-bold mb-4"></h2><p id="result-message" class="text-brand-subtle mb-6"></p><div id="result-details" class="mb-6"></div><button id="result-ok-btn" class="btn w-full bg-brand-accent hover:bg-brand-accent-hover text-white font-bold py-3 px-6 rounded-lg">OK</button></div></div>
    <div id="feedback-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex justify-center items-center p-4"><div class="bg-brand-secondary rounded-2xl shadow-2xl w-full max-w-md text-center p-8"><h2 class="text-2xl font-bold mb-4">Forfeit Feedback</h2><p class="text-brand-subtle mb-6">How difficult was that forfeit?</p><div class="flex justify-around"><button data-feedback="hard" class="btn feedback-btn bg-brand-danger hover:bg-red-500 text-white font-bold py-3 px-6 rounded-lg">Hard</button><button data-feedback="ok" class="btn feedback-btn bg-brand-warning hover:bg-yellow-400 text-black font-bold py-3 px-6 rounded-lg">About Right</button><button data-feedback="easy" class="btn feedback-btn bg-brand-success hover:bg-green-500 text-white font-bold py-3 px-6 rounded-lg">Easy</button></div></div></div>
    <div id="edit-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex justify-center items-center p-4"><div class="bg-brand-secondary rounded-2xl shadow-2xl w-full max-w-md p-6"><h2 id="edit-modal-title" class="text-2xl font-bold mb-6"></h2><form id="edit-form"></form><div class="mt-6 flex justify-end space-x-4"><button id="edit-cancel-btn" class="btn bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Cancel</button><button id="edit-save-btn" class="btn bg-brand-accent hover:bg-brand-accent-hover text-white font-bold py-2 px-4 rounded-lg">Save</button></div></div></div>


<script type="module">
    const App = {
        state: {}, timerInterval: null,
        firebase: { app: null, auth: null, db: null, user: null },

        // --- PASTE YOUR FIREBASE CONFIGURATION HERE ---
        firebaseConfig: {
           // apiKey: "AIza....",
           // authDomain: "your-project-id.firebaseapp.com",
           // projectId: "your-project-id",
           // storageBucket: "your-project-id.appspot.com",
           // messagingSenderId: "...",
           // appId: "1:..."
        },
        
        getDefaultState() { /* ... unchanged ... */ return {"points":100,"tasksPerDay":1,"activeTask":null,"lastTaskDate":null,"dailyTasksAssigned":0,"rewardsRedeemedToday":0,"lastPriceCheckDate":null,"saleIsOn":false,"rewardLog":[],"tasks":[{"id":"t1","name":"Pushups","value":10,"unit":"reps","points":10,"enabled":true},{"id":"t2","name":"Pull ups","value":5,"unit":"reps","points":20,"enabled":true},{"id":"t3","name":"Clean Living Room","value":1,"unit":"area","points":30,"enabled":true}],"rewards":[{"id":"r1","name":"Eat Candy","points":50},{"id":"r2","name":"30min Me Time","points":100},{"id":"r3","name":"Watch a Movie","points":200},{"id":"r4","name":"Smoke a Cigarette","points":25}],"forfeits":{"tasks":[{"id":"ft1","name":"Face the corner","enabled":true}],"positions":[{"id":"fp1","name":"Hands in air","enabled":true}],"duration":600}}; },
        saveState() { localStorage.setItem('taskmaster_state', JSON.stringify(this.state)); },
        loadState() { const s=localStorage.getItem('taskmaster_state');this.state=s?{...this.getDefaultState(),...JSON.parse(s)}:this.getDefaultState();if(!this.state.rewardLog)this.state.rewardLog=[]; },

        async init() {
            this.loadState();
            this.checkDateAndReset();
            this.checkAndAdjustPrices();
            this.attachEventListeners();
            await this.firebaseInit();
            this.render();
            this.checkForNewTask();
        },
        
        async firebaseInit() {
            if (!this.firebaseConfig.apiKey) {
                document.getElementById('main-content').innerHTML = `<div class="text-brand-danger text-center"><h2 class="text-2xl font-bold">Configuration Needed</h2><p>The app owner needs to set up Firebase and paste the config keys into index.html to enable online features.</p></div>`;
                return;
            }
            try {
                this.firebase.app = window.firebase.initializeApp(this.firebaseConfig);
                this.firebase.auth = window.firebase.getAuth(this.firebase.app);
                this.firebase.db = window.firebase.getFirestore(this.firebase.app);

                await window.firebase.signInAnonymously(this.firebase.auth);
                window.firebase.onAuthStateChanged(this.firebase.auth, async (user) => {
                    if (user) {
                        this.firebase.user = user;
                        await this.checkUserDocument();
                    }
                });
            } catch (error) {
                console.error("Firebase Init Error:", error);
                this.showResult("Connection Error", "Could not connect to the database. Leaderboard will be disabled.");
            }
        },

        async checkUserDocument() {
            if (!this.firebase.user) return;
            const userRef = window.firebase.doc(this.firebase.db, "leaderboard", this.firebase.user.uid);
            const userSnap = await window.firebase.getDoc(userRef);

            if (!userSnap.exists()) {
                const displayName = prompt("Welcome! Please enter a display name for the leaderboard:");
                if (displayName) {
                    await window.firebase.setDoc(userRef, {
                        displayName: displayName,
                        dailyPoints: {},
                        createdAt: window.firebase.serverTimestamp()
                    });
                }
            }
        },
        
        async updateScore(points) {
            if (!this.firebase.user) return;
            const userRef = window.firebase.doc(this.firebase.db, "leaderboard", this.firebase.user.uid);
            const today = dayjs().format('YYYY-MM-DD');
            const fieldPath = `dailyPoints.${today}`;
            
            try {
                await window.firebase.updateDoc(userRef, {
                    [fieldPath]: window.firebase.increment(points)
                });
            } catch (error) {
                 // If the document doesn't exist yet, or the map isn't there.
                await window.firebase.setDoc(userRef, {
                    dailyPoints: { [today]: points }
                }, { merge: true });
            }
        },
        
        attachEventListeners() {
            document.getElementById('leaderboard-btn').addEventListener('click', () => this.showLeaderboard());
            // ... (rest of the event listeners are mostly unchanged)
            document.getElementById('manage-btn').addEventListener('click', () => this.showModal('manage-modal'));
            document.getElementById('shop-btn').addEventListener('click', () => { this.renderShopModal(true); this.showModal('shop-modal'); });
            document.querySelectorAll('.close-modal-btn').forEach(btn => btn.addEventListener('click', (e) => this.hideModal(e.target.dataset.modal)));
            document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', (e) => this.switchTab(e.target)));
            document.getElementById('main-content').addEventListener('click', (e) => { if (e.target.id === 'complete-task-btn') this.completeTask(); if (e.target.id === 'fail-task-btn') this.failTask(); if (e.target.id === 'complete-forfeit-btn') this.showModal('feedback-modal'); });
            document.getElementById('result-ok-btn').addEventListener('click', () => { this.hideModal('result-modal'); this.checkForNewTask(); });
            document.querySelectorAll('.feedback-btn').forEach(btn => btn.addEventListener('click', (e) => this.handleForfeitFeedback(e.target.dataset.feedback)));
            document.getElementById('edit-cancel-btn').addEventListener('click', () => this.hideModal('edit-modal'));
            document.getElementById('edit-save-btn').addEventListener('click', () => this.handleSave());
            document.getElementById('shop-modal').addEventListener('click', e => { if (e.target.classList.contains('redeem-reward-btn')) this.redeemReward(e); });
            document.getElementById('log-toggle-btn').addEventListener('click', e => { const isShowingShop = e.target.textContent.includes('History'); this.renderShopModal(!isShowingShop); });
        },

        async completeTask() {
            clearInterval(this.timerInterval);
            const pointsGained = this.state.activeTask.points;
            this.state.points += pointsGained;
            this.state.activeTask = null;
            
            await this.updateScore(pointsGained); // Update score in Firebase
            
            this.saveState();
            this.showResult('Task Complete!', `You earned ${pointsGained} points. Visit the Reward Shop to spend them!`);
            this.render();
        },
        
        async showLeaderboard() {
            this.showModal('leaderboard-modal');
            const container = document.getElementById('leaderboard-content');
            container.innerHTML = '<p class="text-brand-subtle">Loading scores...</p>';

            if (!this.firebase.db) {
                container.innerHTML = '<p class="text-brand-danger">Could not connect to database.</p>';
                return;
            }

            try {
                const querySnapshot = await window.firebase.getDocs(window.firebase.query(window.firebase.collection(this.firebase.db, "leaderboard")));
                const thirtyDaysAgo = dayjs().subtract(30, 'day');
                
                const scores = [];
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    let totalPoints = 0;
                    if (data.dailyPoints) {
                        for (const date in data.dailyPoints) {
                            if (dayjs(date).isAfter(thirtyDaysAgo)) {
                                totalPoints += data.dailyPoints[date];
                            }
                        }
                    }
                    if (totalPoints > 0) {
                        scores.push({ name: data.displayName, score: totalPoints });
                    }
                });

                scores.sort((a, b) => b.score - a.score);

                if (scores.length === 0) {
                    container.innerHTML = '<p class="text-brand-subtle">No scores recorded in the last 30 days.</p>';
                } else {
                    const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
                    container.innerHTML = scores.map((entry, index) => `
                        <div class="flex items-center justify-between p-3 rounded-lg bg-brand-primary mb-2">
                            <div class="flex items-center">
                                <span class="text-2xl w-8 text-center">${medals[index] || index + 1}</span>
                                <p class="font-semibold ml-2">${entry.name || 'Anonymous'}</p>
                            </div>
                            <p class="font-bold text-brand-gold">${entry.score} Points</p>
                        </div>
                    `).join('');
                }

            } catch (error) {
                console.error("Error getting leaderboard:", error);
                container.innerHTML = '<p class="text-brand-danger">Failed to load leaderboard data.</p>';
            }
        },

        // --- UNCHANGED CORE LOGIC AND RENDERING METHODS ---
        checkDateAndReset() { /* ... unchanged ... */ const t=dayjs().format('YYYY-MM-DD');if(this.state.lastTaskDate!==t){this.state.lastTaskDate=t;this.state.dailyTasksAssigned=0;this.saveState();} },
        checkAndAdjustPrices() { /* ... unchanged ... */ const t=dayjs().format('YYYY-MM-DD');if(this.state.lastPriceCheckDate&&this.state.lastPriceCheckDate!==t){if(this.state.rewardsRedeemedToday>=3){this.state.rewards.forEach(r=>r.points=Math.round(r.points*1.05));this.state.saleIsOn=false;}else if(this.state.rewardsRedeemedToday===0){this.state.rewards.forEach(r=>r.points=Math.max(1,Math.round(r.points*0.95)));this.state.saleIsOn=true;}else{this.state.saleIsOn=false;}this.state.rewardsRedeemedToday=0;}this.state.lastPriceCheckDate=t;this.saveState(); },
        checkForNewTask() { if(!this.state.activeTask&&this.state.dailyTasksAssigned<this.state.tasksPerDay){this.assignTask();} },
        assignTask() { const e=this.state.tasks.filter(t=>t.enabled);if(e.length===0){this.showResult('No Tasks','Please enable some tasks in the management menu to continue.');return;}const t=e[Math.floor(Math.random()*e.length)];this.state.activeTask={id:t.id,name:`${t.value} ${t.unit==='area'?'':t.unit} ${t.name}`,assignedAt:Date.now(),type:'task',points:t.points};this.state.dailyTasksAssigned++;this.saveState();this.render();},
        failTask() { clearInterval(this.timerInterval);this.state.activeTask=null;this.assignForfeit();this.saveState();this.render(); },
        assignForfeit() { const t=this.state.forfeits.tasks.filter(t=>t.enabled),o=this.state.forfeits.positions.filter(p=>p.enabled);if(t.length===0||o.length===0){this.showResult('Forfeit Skipped','No forfeits are enabled. Lucky you!');return;}const e=t[Math.floor(Math.random()*t.length)],s=o[Math.floor(Math.random()*o.length)];this.state.activeTask={id:`f-${Date.now()}`,name:e.name,position:s.name,duration:this.state.forfeits.duration,assignedAt:Date.now(),type:'forfeit'};this.saveState();this.showResult('Task Failed','A forfeit has been assigned.');this.render();},
        handleForfeitFeedback(e){const t=this.state.forfeits.duration;if(e==='easy'){this.state.forfeits.duration=Math.round(t*1.1);if(this.state.tasksPerDay<12)this.state.tasksPerDay++;}else if(e==='ok'){this.state.forfeits.duration=Math.round(t*1.05);}else if(e==='hard'){this.state.forfeits.duration=Math.round(t*.9);if(this.state.tasksPerDay>1)this.state.tasksPerDay--;}this.state.activeTask=null;this.hideModal('feedback-modal');this.saveState();this.showResult('Forfeit Complete','Your feedback has been recorded.');this.render();},
        redeemReward(e){const{id:t}=e.target.dataset,o=this.state.rewards.find(r=>r.id===t);if(o&&this.state.points>=o.points){this.state.points-=o.points;this.state.rewardsRedeemedToday++;this.state.rewardLog.unshift({name:o.name,points:o.points,redeemedAt:Date.now()});this.saveState();this.render();this.renderShopModal(true);this.showResult('Reward Claimed!',`You redeemed "${o.name}" for ${o.points} points.`);}},
        render(){this.renderMainContent();this.renderManagement();document.getElementById('points-display').textContent=this.state.points;},
        renderMainContent() { const m=document.getElementById('main-content');if(this.state.activeTask){if(this.state.activeTask.type==='task'){this.renderActiveTask(m);}else{this.renderActiveForfeit(m);}}else{m.innerHTML=`<h2 class="text-2xl font-bold text-brand-text mb-2">All Clear!</h2><p class="text-brand-subtle">Waiting for the next task.</p>`;}},
        renderActiveTask(c){const t=this.state.activeTask,d=t.assignedAt+864e5;c.innerHTML=`<p class="text-brand-subtle mb-2">Your Task:</p><h2 class="text-3xl font-bold text-brand-text mb-4">${t.name}</h2><div class="text-lg text-brand-warning mb-6" id="timer"></div><div class="flex space-x-4"><button id="complete-task-btn" class="btn bg-brand-success hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg">Complete</button><button id="fail-task-btn" class="btn bg-brand-danger hover:bg-red-500 text-white font-bold py-3 px-8 rounded-lg">Can't Do It</button></div>`;const e=document.getElementById('timer');clearInterval(this.timerInterval);this.timerInterval=setInterval(()=>{const n=Date.now(),s=d-n;if(s<=0){clearInterval(this.timerInterval);e.textContent="Time's Up!";this.failTask();}else{const h=Math.floor(s%864e5/36e5),m=Math.floor(s%36e5/6e4),c=Math.floor(s%6e4/1e3);e.textContent=`Time left: ${h}h ${m}m ${c}s`;}},1e3);},
        renderActiveForfeit(c){const f=this.state.activeTask,d=dayjs.duration(f.duration,'seconds').format('m [minutes and] s [seconds]');c.innerHTML=`<p class="text-brand-subtle mb-2">Your Forfeit:</p><h2 class="text-3xl font-bold text-brand-danger mb-2">${f.name}</h2><p class="text-xl text-brand-subtle mb-2">Position: ${f.position}</p><p class="text-xl text-brand-warning mb-6">Duration: ${d}</p><button id="complete-forfeit-btn" class="btn bg-brand-accent hover:bg-brand-accent-hover text-white font-bold py-3 px-8 rounded-lg">I have completed my forfeit</button>`;},
        switchTab(e){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('tab-active'));e.classList.add('tab-active');document.querySelectorAll('.tab-content').forEach(c=>c.classList.add('hidden'));document.getElementById(`${e.dataset.tab}-tab`).classList.remove('hidden');this.renderManagement();},
        renderManagement(){const a=document.querySelector('#manage-modal .tab-active').dataset.tab;if(a==='tasks')this.renderList('tasks',this.state.tasks,['name','value','unit','points']);if(a==='forfeits')this.renderForfeitsTab();if(a==='settings')this.renderSettingsTab();},
        renderShopModal(s){const c=document.getElementById('shop-content'),t=document.getElementById('log-toggle-btn');if(s){const a=this.state.saleIsOn?`<div class="bg-green-500/20 border border-green-500 text-green-300 text-center p-3 rounded-lg mb-4">ðŸ”¥ **REWARD SALE ON!** All prices are 5% off today! ðŸ”¥</div>`:'';const i=this.state.rewards.map(item=>{const n=this.state.points>=item.points;return` <div class="flex items-center justify-between p-3 rounded-lg bg-brand-primary mb-2 ${n?'':'opacity-50'}"> <div> <p class="font-semibold">${item.name}</p> <p class="text-sm font-bold ${this.state.saleIsOn?'text-green-400':'text-brand-accent'}">${item.points} Points</p> </div> <button class="btn redeem-reward-btn bg-brand-accent hover:bg-brand-accent-hover text-white font-bold py-1 px-3 rounded-md text-sm" data-id="${item.id}" ${n?'':'disabled'}>Redeem</button> </div>`}).join('');c.innerHTML=a+i;t.textContent='View Purchase History';}else{let l='<h3 class="text-lg font-bold mb-4">Purchase History</h3>';if(this.state.rewardLog.length===0){l+='<p class="text-brand-subtle">You haven\'t purchased any rewards yet.</p>';}else{l+=this.state.rewardLog.map(log=>` <div class="flex justify-between items-center p-2 bg-brand-primary rounded-md mb-2"> <div> <p class="font-semibold">${log.name}</p> <p class="text-xs text-brand-subtle">${dayjs(log.redeemedAt).fromNow()}</p> </div> <p class="font-bold text-brand-accent">${log.points}</p> </div>`).join('');}c.innerHTML=l;t.textContent='Back to Shop';}},
        renderList(t,i,f){const c=document.getElementById(`${t}-tab`),h=i.map(item=>`...`).join('');c.innerHTML=`...`;c.querySelectorAll('.form-checkbox').forEach(b=>b.addEventListener('change',e=>this.toggleEnable(e)));c.querySelectorAll('.delete-item-btn').forEach(b=>b.addEventListener('click',e=>this.deleteItem(e)));c.querySelectorAll('.add-item-btn').forEach(b=>b.addEventListener('click',e=>this.handleAddItem(e)));c.querySelectorAll('.edit-item-btn').forEach(b=>b.addEventListener('click',e=>this.handleEditItem(e)));},
        renderForfeitsTab(){/* ... */}, renderSettingsTab(){/* ... */},
        toggleEnable(e){const{type:t,id:i,subtype:s}=e.target.dataset;let a;if(t==='forfeits'){a=this.state.forfeits[s].find(item=>item.id===i);}else{a=this.state[t].find(item=>item.id===i);}if(a){a.enabled=e.target.checked;this.saveState();this.render();}},
        deleteItem(e){const{type:t,id:i,subtype:s}=e.target.closest('button').dataset;if(confirm('Are you sure?')){if(t==='forfeits'){this.state.forfeits[s]=this.state.forfeits[s].filter(item=>item.id!==i);}else{this.state[t]=this.state[t].filter(item=>item.id!==i);}this.saveState();this.render();}},
        handleAddItem(e){const{type:t,subtype:s}=e.target.dataset;this.openEditModal(t,null,s);},
        handleEditItem(e){const{type:t,id:i}=e.target.closest('button').dataset;this.openEditModal(t,i);},
        openEditModal(t,i,s=null){/* ... */}, handleSave(){/* ... */},
        showModal(id){document.getElementById(id).classList.remove('hidden');}, hideModal(id){document.getElementById(id).classList.add('hidden');},
        showResult(t,m,d=''){document.getElementById('result-title').textContent=t;document.getElementById('result-message').textContent=m;document.getElementById('result-details').innerHTML=d;this.showModal('result-modal');},
    };

    document.addEventListener('DOMContentLoaded', () => App.init());
</script>

</body>
</html>
